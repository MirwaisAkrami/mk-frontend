<div class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-900">Message Statistics</h2>
        <select
          class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"
          [value]="selectedRange()"
          (change)="onRangeChange($event)"
        >
          <option value="7">Last 7 Days</option>
          <option value="30">Last 30 Days</option>
          <option value="90">Last 90 Days</option>
        </select>
      </div>

      @if (loading()) {
        <div class="bg-white rounded-lg shadow p-6 text-center text-gray-400">
          Loading statistics...
        </div>
      } @else if (error()) {
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 text-sm">
          {{ error() }}
        </div>
      } @else if (stats()) {
        <!-- Summary Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-white rounded-lg shadow p-4">
            <div class="text-xs font-medium text-gray-500 uppercase">Total Messages</div>
            <div class="text-2xl font-bold text-gray-900 mt-1">{{ formatNumber(stats()?.totalMessageCount) }}</div>
          </div>
          <div class="bg-white rounded-lg shadow p-4">
            <div class="text-xs font-medium text-gray-500 uppercase">Direct Messages</div>
            <div class="text-2xl font-bold text-blue-600 mt-1">{{ formatNumber(stats()?.directMessageCount) }}</div>
          </div>
          <div class="bg-white rounded-lg shadow p-4">
            <div class="text-xs font-medium text-gray-500 uppercase">Group Messages</div>
            <div class="text-2xl font-bold text-purple-600 mt-1">{{ formatNumber(stats()?.groupMessageCount) }}</div>
          </div>
          <div class="bg-white rounded-lg shadow p-4">
            <div class="text-xs font-medium text-gray-500 uppercase">Last Seen</div>
            <div class="text-lg font-bold text-gray-900 mt-1">{{ formatLastSeen(stats()?.lastSeenSecondsAgo) }}</div>
          </div>
        </div>

        <div class="mt-4"></div>
        <!-- Message Volume Chart -->
        <app-simple-chart
          title="Message Volume Over Time"
          type="line"
          [labels]="getChartLabels()"
          [datasets]="getChartData()"
          [loading]="false"
        ></app-simple-chart>

        <!-- Top Peers Table -->
        <div class="bg-white rounded-lg shadow">
          <div class="px-4 py-3 border-b border-gray-200">
            <h3 class="text-sm font-semibold text-gray-700">Top Contacts (by message volume)</h3>
          </div>
          @if (stats()?.topPeers && stats()!.topPeers.length > 0) {
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Peer</th>
                    <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Messages</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                  @for (peer of stats()?.topPeers; track peer.peer; let i = $index) {
                    <tr class="hover:bg-gray-50">
                      <td class="px-4 py-2 text-sm text-gray-500">{{ i + 1 }}</td>
                      <td class="px-4 py-2 text-sm">
                        <a [routerLink]="['/users', extractUsername(peer.peer)]" class="text-blue-600 hover:underline">
                          {{ peer.peer }}
                        </a>
                      </td>
                      <td class="px-4 py-2 text-sm text-gray-900 text-right">{{ formatNumber(peer.messageCount) }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="p-8 text-center text-gray-400">No contacts found in this period</div>
          }
        </div>
      }
    </div>