<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
  <!-- Top Users Table -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-sm font-semibold text-gray-700">Top Users by Messages</h3>
      <button
        class="text-xs text-blue-600 hover:text-blue-800"
        (click)="exportTopUsers.emit()"
      >
        Export CSV
      </button>
    </div>
    <div class="overflow-x-auto">
      @if (loadingTopUsers) {
        <div class="p-8 text-center text-gray-400">Loading...</div>
      } @else if (topUsers.length === 0) {
        <div class="p-8 text-center text-gray-400">No data</div>
      } @else {
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">User</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Direct</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Group</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @for (user of topUsers; track user.username; let i = $index) {
              <tr
                class="hover:bg-gray-50 cursor-pointer"
                [routerLink]="['/users', user.username]"
              >
                <td class="px-4 py-2 text-sm text-gray-500">{{ i + 1 }}</td>
                <td class="px-4 py-2 text-sm font-medium text-blue-600">{{ user.username }}</td>
                <td class="px-4 py-2 text-sm text-gray-900 text-right">{{ formatNumber(user.messageCount) }}</td>
                <td class="px-4 py-2 text-sm text-gray-500 text-right">{{ formatNumber(user.directMessageCount) }}</td>
                <td class="px-4 py-2 text-sm text-gray-500 text-right">{{ formatNumber(user.groupMessageCount) }}</td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>

  <!-- Top Conversations Table -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-sm font-semibold text-gray-700">Top Conversations</h3>
      <button
        class="text-xs text-blue-600 hover:text-blue-800"
        (click)="exportTopConversations.emit()"
      >
        Export CSV
      </button>
    </div>
    <div class="overflow-x-auto">
      @if (loadingTopConversations) {
        <div class="p-8 text-center text-gray-400">Loading...</div>
      } @else if (topConversations.length === 0) {
        <div class="p-8 text-center text-gray-400">No data</div>
      } @else {
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">User 1</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">User 2</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Messages</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @for (conv of topConversations; track conv.user1 + conv.user2; let i = $index) {
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-2 text-sm text-gray-500">{{ i + 1 }}</td>
                <td class="px-4 py-2 text-sm">
                  <a [routerLink]="['/users', conv.user1]" class="text-blue-600 hover:underline">{{ conv.user1 }}</a>
                </td>
                <td class="px-4 py-2 text-sm">
                  <a [routerLink]="['/users', conv.user2]" class="text-blue-600 hover:underline">{{ conv.user2 }}</a>
                </td>
                <td class="px-4 py-2 text-sm text-gray-900 text-right">{{ formatNumber(conv.messageCount) }}</td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>

  <!-- Online Rooms Table -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-4 py-3 border-b border-gray-200">
      <h3 class="text-sm font-semibold text-gray-700">Online Rooms</h3>
    </div>
    <div class="overflow-x-auto">
      @if (loadingOnlineRooms) {
        <div class="p-8 text-center text-gray-400">Loading...</div>
      } @else if (onlineRooms.length === 0) {
        <div class="p-8 text-center text-gray-400">No online rooms</div>
      } @else {
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Room</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Host</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Participants</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @for (room of onlineRooms; track room.name + room.host; let i = $index) {
              <tr
                class="hover:bg-gray-50 cursor-pointer"
                [routerLink]="['/groups', room.name]"
              >
                <td class="px-4 py-2 text-sm text-gray-500">{{ i + 1 }}</td>
                <td class="px-4 py-2 text-sm font-medium text-blue-600">{{ room.name }}</td>
                <td class="px-4 py-2 text-sm text-gray-500">{{ room.host }}</td>
                <td class="px-4 py-2 text-sm text-gray-900 text-right">
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    {{ room.participantCount }}
                  </span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>

  <!-- Offline Queue Table -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-4 py-3 border-b border-gray-200">
      <h3 class="text-sm font-semibold text-gray-700">Offline Queue (Pending Messages)</h3>
    </div>
    <div class="overflow-x-auto">
      @if (loadingSpoolSummary) {
        <div class="p-8 text-center text-gray-400">Loading...</div>
      } @else if (spoolSummary.length === 0) {
        <div class="p-8 text-center text-gray-400">No pending messages</div>
      } @else {
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">User</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Pending</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @for (spool of spoolSummary; track spool.username; let i = $index) {
              <tr
                class="hover:bg-gray-50 cursor-pointer"
                [routerLink]="['/users', spool.username]"
              >
                <td class="px-4 py-2 text-sm text-gray-500">{{ i + 1 }}</td>
                <td class="px-4 py-2 text-sm font-medium text-blue-600">{{ spool.username }}</td>
                <td class="px-4 py-2 text-sm text-right">
                  <span
                    class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium"
                    [class]="spool.messageCount > 100 ? 'bg-red-100 text-red-800' : spool.messageCount > 10 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'"
                  >
                    {{ formatNumber(spool.messageCount) }}
                  </span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>
</div>
